id: wp-yoast-author-sitemap-username-enumeration-extractor

info:
  name: WordPress Yoast SEO Plugin - User Enumeration and Extracttion
  author: Caddyshack2175
  severity: info
  reference:
    - https://developer.yoast.com/features/xml-sitemaps/functional-specification/
  classification:
    cpe: cpe:2.3:a:yoast:yoast_seo:*:*:*:*:wordpress:*:*:*
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    cvss-score: 5.3
  tags: information, discloser, wordpress, enum, user, wp, wp-plugin

http:
  - raw:
      - |
        GET /author-sitemap.xml HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "<?xml"
          - "<lastmod>"
          - "<loc>"
        condition: and

      - type: word
        part: header
        words:
          - "application/xml"
          - "text/xml"
        condition: or

      - type: status
        status:
          - 200

      - type: dsl
        dsl:
          - 'len(body) > 100'

    extractors:
      - type: regex
        name: usernames
        regex:
          - '\/author\/([^\/\?<]+)'
        group: 1

      - type: regex
        name: sitemap_lastmod
        regex:
          - '<url>\s*<loc>([^<]*\/author\/[^<]+)<\/loc>\s*<lastmod>([^<]+)<\/lastmod>'
        group: 2
        
      - type: dsl
        name: user_count
        dsl:
          - 'len(split(body, "/author/")) - 1'
