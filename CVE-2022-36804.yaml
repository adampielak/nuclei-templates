id: CVE-2022-36804

info:
  name: "Easily Exploitable Vulnerability in Atlassian Bitbucket Server and Data Center"
  author: topscoder
  severity: critical
  description: |
    The advisory reveals a command injection vulnerability in multiple API endpoints,
    which allows an attacker with access to a public repository or with read permissions
    to a private Bitbucket repository to execute arbitrary code by sending a malicious HTTP request.
  reference:
    - https://attackerkb.com/topics/iJIxJ6JUow/cve-2022-36804/rapid7-analysis
    - https://www.rapid7.com/blog/post/2022/09/20/cve-2022-36804-easily-exploitable-vulnerability-in-atlassian-bitbucket-server-and-data-center/
    - https://github.com/khal4n1/CVE-2022-36804
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2022-36804
  metadata:
    fofa-query: "bitbucket/repos?visibility=public"
    google-query: inurl:"bitbucket/repos?visibility=public"
    shodan-query:
      - 'vuln:CVE-2022-36804'
      - 'Bitbucket Server'
      - 'Bitbucket Data Center'
  tags: critical,atlassian,easy,cve

http:
  - method: GET
    path:
      - "{{BaseURL}}/bitbucket/repos?visibility=public"
      - "{{BaseURL}}/repos?visibility=public"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)v([0-9.]+)<"
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)v([0-9.]+)<"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "Atlassian Bitbucket"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '>= 7.6 ', '<= 7.6.17')
          - compare_versions(version, '>= 7.17', '<= 7.17.10')
          - compare_versions(version, '>= 7.21', '<= 7.21.4')
          - compare_versions(version, '>= 8.0 ', '<= 8.0.3')
          - compare_versions(version, '>= 8.1 ', '<= 8.1.3')
          - compare_versions(version, '>= 8.2 ', '<= 8.2.2')
          - compare_versions(version, '>= 8.3 ', '<= 8.3.1')