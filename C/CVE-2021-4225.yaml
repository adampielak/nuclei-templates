id: CVE-2021-4225

info:
  name: "SP Project & Document Manager  <= 4.23 - Subscriber+ Arbitrary File Upload"
  author: topscoder
  severity: high
  description: "The SP Project & Document Manager WordPress plugin before 4.24 allows any authenticated users, such as subscribers, to upload files. The plugin attempts to prevent PHP and other similar files that could be executed on the server from being uploaded by checking the file extension. It was discovered that on Windows servers, the security checks in place were insufficient, enabling bad actors to potentially upload backdoors on vulnerable sites."
  reference:
    - https://wpscan.com/vulnerability/bd1083d1-edcc-482e-a8a9-c8b6c8d417bd
    - https://github.com/pang0lin/CVEproject/blob/main/wordpress_SP-Project_fileupload.md
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2021-4225
  metadata:
    fofa-query: "wp-content/plugins/sp-client-document-manager/"
    google-query: inurl:"/wp-content/plugins/sp-client-document-manager/"
    shodan-query: 'vuln:CVE-2021-4225'
  tags: cve,wordpress,wp-plugin,sp-client-document-manager,high

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/sp-client-document-manager/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "sp-client-document-manager"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '< 4.24')