id: CVE-2022-1165

info:
  name: "Blackhole for Bad Bots <= 3.3.1 - Arbitrary IP Address Blocking via IP Spoofing"
  author: topscoder
  severity: critical
  description: "The Blackhole for Bad Bots WordPress plugin before 3.3.2 uses headers such as CF-CONNECTING-IP, CLIENT-IP etc to determine the IP address of requests hitting the blackhole URL, which allows them to be spoofed. This could result in blocking arbitrary IP addresses, such as legitimate/good search engine crawlers / bots. This could also be abused by competitors to cause damage related to visibility in search engines, can be used to bypass arbitrary blocks caused by this plugin, block any visitor or even the administrator and even more."
  reference:
    - https://wpscan.com/vulnerability/10d85913-ea8c-4c2e-a32e-fa61cf191710
    - https://plugins.trac.wordpress.org/changeset/2666486
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H
    cvss-score: 9.1
    cve-id: CVE-2022-1165
  metadata:
    fofa-query: "wp-content/plugins/blackhole-bad-bots/"
    google-query: inurl:"/wp-content/plugins/blackhole-bad-bots/"
    shodan-query: 'vuln:CVE-2022-1165'
  tags: cve,wordpress,wp-plugin,blackhole-bad-bots,critical

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/blackhole-bad-bots/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "blackhole-bad-bots"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '< 3.3.2')