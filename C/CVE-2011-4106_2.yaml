id: CVE-2011-4106

info:
  name: "TimThumb <= 1.33 - Remote File Download"
  author: topscoder
  severity: critical
  description: "TimThumb (timthumb.php) before 2.0 does not validate the entire source with the domain white list, which allows remote attackers to upload and execute arbitrary code via a URL containing a white-listed domain in the src parameter, then accessing it via a direct request to the file in the cache directory, as exploited in the wild in August 2011. Note: this is not a WordPress plugin or theme, but may be used by WordPress plugins and themes. Make sure to check for the presence of  the timthumb.php file when determining if your installation is vulnerable."
  reference:
    - http://www.exploit-db.com/exploits/17872
    - http://www.binarymoon.co.uk/2011/08/timthumb-2/
    - http://www.openwall.com/lists/oss-security/2011/11/03/4
    - http://www.exploit-db.com/exploits/17602
    - http://code.google.com/p/timthumb/issues/detail?id=212
    - https://web.archive.org/web/20180102172527/markmaunder.com/2011/08/02/technical-details-and-scripts-of-the-wordpress-timthumb-php-hack/
    - https://web.archive.org/web/20180528073456/https%3A//markmaunder.com/2011/08/01/zero-day-vulnerability-in-many-wordpress-themes/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2011-4106
  metadata:
    fofa-query: "wp-content/plugins/category-list-portfolio-page/"
    google-query: inurl:"/wp-content/plugins/category-list-portfolio-page/"
    shodan-query: 'vuln:CVE-2011-4106'
  tags: cve,wordpress,wp-plugin,category-list-portfolio-page,critical

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/category-list-portfolio-page/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "category-list-portfolio-page"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '>0')